---
title: "AFMC We Need - Text Mining Project"
subtitle: "Interim Report to AFMC"
author: "Jason Freels"
date: "2/26/2020"
output: 
  html_document:
    df_print: "paged"
    toc: true
    toc_float: yes
---

```{r setup, include=FALSE, eval=FALSE}
knitr::opts_chunk$set(echo = TRUE)
devtools::install_github("clawilso15/Text.Replace")
```

## Background

The "AFMC We Need" effort surveyed the AFMC workforce to capture their responses on how best to improve the MAJCOM. 

This project aims to assist AMFC analysts extract insights from this survey through development of a software package using the statistical programming environment R.

- Generate visualizations
- Automate reports

Assumptions:

- The survey data are stored in a columnar format
- Respondents are asked about how to make improvements by identifying both positive and negative trends 
- Respondents state they want to see an increased trend of positives and a decreasing trend of negatives
- Respondents will use certain phrases to identify these desires for trends

## Demo

This demo is intended to show how an intended user would interact with the package to return a desired result

This demo assumes that the user has the R programming environment installed on their machine as well as the RStudio Integrated development environment.  If this is not the case the user may refer to the AFIT guide to R to see detailed instructions on setting up their machine 

The user will first need to install the `Text.Replace` package.  This package has not yet been published to the main package repository for the R language (known as the Comprehensive R Archive Network, or CRAN. Therefore, it cannot be installed from CRAN, but can be installed from Github using the code shown below

```{r, eval=FALSE}
# If the devtools package is not already installed
# the code below installs the package from the CRAN
if(!("devtools" %in% names(installed.packages()[,"Package"]))) {
  
   install.packages("devtools")
  
}

# With the devtools package now installed we can use it 
# to install the Text.Replace package from Github  
devtools::install_github("clawilso15/Text.Replace")
```

Now that the package has been installed the user needs to load it into their working environment so that the functions contained in the package are available for use. 

```{r}
library(Text.Replace)
```

With the package installed, our first step is to extract the text data from the file in which it is contained. The `Text.Replace` package includes the `extract_text()` function to ingest text data from the following file types

- Columnar data: CSV, XLS, XLSX
- Tab Delimited: TXT
- MS Word Files: DOC, DOCX
- PDF files
- Images Files: PDF, PNG, TIF

This function is used as shown below

```{r, eval=FALSE}
csv = file.choose()
DATA = Text.Replace::extract_text(csv)
```

```{r, echo=FALSE}
csv = "C:\\Users\\Aubur\\github\\auburngrads\\afmc_we_need\\data\\AWNComment_Freels.csv"
DATA = Text.Replace::extract_text(csv)
```

## Example on the AFMC We Need Data


AFMC_corpus = Text.Replace::create_corpus(DATA, "Comments")
```

```{r}
AFMC_dfm = Text.Replace:::create_dfm(AFMC_corpus, 
                                     num_ngrams = 6,
                                     remove_punct = T,
                                     tolower = TRUE, 
                                     stem = FALSE, 
                                     select = NULL, 
                                     remove = NULL, 
                                     dictionary = NULL, 
                                     thesaurus = NULL, 
                                     groups = NULL)
```

```{r, fig.width=10}
AFMC_dfm_Q1 = quanteda::dfm_subset(AFMC_dfm[[1]], subset = Question == 1)

AFMC_dfm_trim = quanteda::dfm_trim(AFMC_dfm_Q1, 
                                   min_termfreq = 10)
```

```{r}
# basic wordcloud
quanteda::textplot_wordcloud(AFMC_dfm_trim)

freq <- Matrix::colSums(AFMC_dfm_trim)
word <- names(freq)
freq <- unname(freq)
ord <- order(freq, decreasing = T)
word <- word[ord]
freq <- freq[ord]

df <- data.frame(term = word, frequency = freq) ; df
```

```{r, eval=FALSE}
kwic(toks, pattern = phrase(multiword))
```

```{r}
  tidy_out1 %>%
    top_n(10) %>%
    ungroup() %>%
    mutate(bigram = reorder(term, count)) %>%
    ggplot(aes(bigram, count, fill = count)) +
    geom_col(show.legend = FALSE) +
    labs(y = "Mentions",
         x = NULL) +
    coord_flip()
```